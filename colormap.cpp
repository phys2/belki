#include "colormap.h"

#include <opencv2/imgproc/imgproc.hpp>

QColor Colormap::qcolor(const cv::Vec3b &color)
{
	return QColor(color[0], color[1], color[2]);
}

cv::Mat1b Colormap::prepare(const cv::Mat &source, double scale, double minVal)
{
	cv::Mat1b ret(source.rows, source.cols);
	scale *= 255.;
	source.convertTo(ret, CV_8U, scale, -scale*minVal);
	return ret;
}

cv::Mat3b Colormap::apply(const cv::Mat &source, double scale, double minVal)
{
	return apply(prepare(source, scale, minVal));
}

cv::Mat3b Colormap::apply(const cv::Mat1b &source)
{
	cv::Mat3b ret;
	cv::applyColorMap(source, ret, map);
	return ret;
}

QPixmap Colormap::pixmap(const cv::Mat3b &source)
{
	return QPixmap::fromImage({source.data, source.cols, source.rows,
	                           (int)source.step, QImage::Format_RGB888});
}

/* Magma map from https://github.com/BIDS/colormap/blob/master/colormaps.py */
Colormap Colormap::magma({{
    {0, 0, 4},
    {1, 0, 5},
    {1, 1, 6},
    {1, 1, 8},
    {2, 1, 9},
    {2, 2, 11},
    {2, 2, 13},
    {3, 3, 15},
    {3, 3, 18},
    {4, 4, 20},
    {5, 4, 22},
    {6, 5, 24},
    {6, 5, 26},
    {7, 6, 28},
    {8, 7, 30},
    {9, 7, 32},
    {10, 8, 34},
    {11, 9, 36},
    {12, 9, 38},
    {13, 10, 41},
    {14, 11, 43},
    {16, 11, 45},
    {17, 12, 47},
    {18, 13, 49},
    {19, 13, 52},
    {20, 14, 54},
    {21, 14, 56},
    {22, 15, 59},
    {24, 15, 61},
    {25, 16, 63},
    {26, 16, 66},
    {28, 16, 68},
    {29, 17, 71},
    {30, 17, 73},
    {32, 17, 75},
    {33, 17, 78},
    {34, 17, 80},
    {36, 18, 83},
    {37, 18, 85},
    {39, 18, 88},
    {41, 17, 90},
    {42, 17, 92},
    {44, 17, 95},
    {45, 17, 97},
    {47, 17, 99},
    {49, 17, 101},
    {51, 16, 103},
    {52, 16, 105},
    {54, 16, 107},
    {56, 16, 108},
    {57, 15, 110},
    {59, 15, 112},
    {61, 15, 113},
    {63, 15, 114},
    {64, 15, 116},
    {66, 15, 117},
    {68, 15, 118},
    {69, 16, 119},
    {71, 16, 120},
    {73, 16, 120},
    {74, 16, 121},
    {76, 17, 122},
    {78, 17, 123},
    {79, 18, 123},
    {81, 18, 124},
    {82, 19, 124},
    {84, 19, 125},
    {86, 20, 125},
    {87, 21, 126},
    {89, 21, 126},
    {90, 22, 126},
    {92, 22, 127},
    {93, 23, 127},
    {95, 24, 127},
    {96, 24, 128},
    {98, 25, 128},
    {100, 26, 128},
    {101, 26, 128},
    {103, 27, 128},
    {104, 28, 129},
    {106, 28, 129},
    {107, 29, 129},
    {109, 29, 129},
    {110, 30, 129},
    {112, 31, 129},
    {114, 31, 129},
    {115, 32, 129},
    {117, 33, 129},
    {118, 33, 129},
    {120, 34, 129},
    {121, 34, 130},
    {123, 35, 130},
    {124, 35, 130},
    {126, 36, 130},
    {128, 37, 130},
    {129, 37, 129},
    {131, 38, 129},
    {132, 38, 129},
    {134, 39, 129},
    {136, 39, 129},
    {137, 40, 129},
    {139, 41, 129},
    {140, 41, 129},
    {142, 42, 129},
    {144, 42, 129},
    {145, 43, 129},
    {147, 43, 128},
    {148, 44, 128},
    {150, 44, 128},
    {152, 45, 128},
    {153, 45, 128},
    {155, 46, 127},
    {156, 46, 127},
    {158, 47, 127},
    {160, 47, 127},
    {161, 48, 126},
    {163, 48, 126},
    {165, 49, 126},
    {166, 49, 125},
    {168, 50, 125},
    {170, 51, 125},
    {171, 51, 124},
    {173, 52, 124},
    {174, 52, 123},
    {176, 53, 123},
    {178, 53, 123},
    {179, 54, 122},
    {181, 54, 122},
    {183, 55, 121},
    {184, 55, 121},
    {186, 56, 120},
    {188, 57, 120},
    {189, 57, 119},
    {191, 58, 119},
    {192, 58, 118},
    {194, 59, 117},
    {196, 60, 117},
    {197, 60, 116},
    {199, 61, 115},
    {200, 62, 115},
    {202, 62, 114},
    {204, 63, 113},
    {205, 64, 113},
    {207, 64, 112},
    {208, 65, 111},
    {210, 66, 111},
    {211, 67, 110},
    {213, 68, 109},
    {214, 69, 108},
    {216, 69, 108},
    {217, 70, 107},
    {219, 71, 106},
    {220, 72, 105},
    {222, 73, 104},
    {223, 74, 104},
    {224, 76, 103},
    {226, 77, 102},
    {227, 78, 101},
    {228, 79, 100},
    {229, 80, 100},
    {231, 82, 99},
    {232, 83, 98},
    {233, 84, 98},
    {234, 86, 97},
    {235, 87, 96},
    {236, 88, 96},
    {237, 90, 95},
    {238, 91, 94},
    {239, 93, 94},
    {240, 95, 94},
    {241, 96, 93},
    {242, 98, 93},
    {242, 100, 92},
    {243, 101, 92},
    {244, 103, 92},
    {244, 105, 92},
    {245, 107, 92},
    {246, 108, 92},
    {246, 110, 92},
    {247, 112, 92},
    {247, 114, 92},
    {248, 116, 92},
    {248, 118, 92},
    {249, 120, 93},
    {249, 121, 93},
    {249, 123, 93},
    {250, 125, 94},
    {250, 127, 94},
    {250, 129, 95},
    {251, 131, 95},
    {251, 133, 96},
    {251, 135, 97},
    {252, 137, 97},
    {252, 138, 98},
    {252, 140, 99},
    {252, 142, 100},
    {252, 144, 101},
    {253, 146, 102},
    {253, 148, 103},
    {253, 150, 104},
    {253, 152, 105},
    {253, 154, 106},
    {253, 155, 107},
    {254, 157, 108},
    {254, 159, 109},
    {254, 161, 110},
    {254, 163, 111},
    {254, 165, 113},
    {254, 167, 114},
    {254, 169, 115},
    {254, 170, 116},
    {254, 172, 118},
    {254, 174, 119},
    {254, 176, 120},
    {254, 178, 122},
    {254, 180, 123},
    {254, 182, 124},
    {254, 183, 126},
    {254, 185, 127},
    {254, 187, 129},
    {254, 189, 130},
    {254, 191, 132},
    {254, 193, 133},
    {254, 194, 135},
    {254, 196, 136},
    {254, 198, 138},
    {254, 200, 140},
    {254, 202, 141},
    {254, 204, 143},
    {254, 205, 144},
    {254, 207, 146},
    {254, 209, 148},
    {254, 211, 149},
    {254, 213, 151},
    {254, 215, 153},
    {254, 216, 154},
    {253, 218, 156},
    {253, 220, 158},
    {253, 222, 160},
    {253, 224, 161},
    {253, 226, 163},
    {253, 227, 165},
    {253, 229, 167},
    {253, 231, 169},
    {253, 233, 170},
    {253, 235, 172},
    {252, 236, 174},
    {252, 238, 176},
    {252, 240, 178},
    {252, 242, 180},
    {252, 244, 182},
    {252, 246, 184},
    {252, 247, 185},
    {252, 249, 187},
    {252, 251, 189},
    {252, 253, 191},
}});

Colormap Colormap::stoplight({{
	{255, 0, 0},
	{254, 1, 0},
	{253, 2, 0},
	{252, 3, 0},
	{251, 4, 0},
	{250, 5, 0},
	{249, 6, 0},
	{248, 7, 0},
	{247, 8, 0},
	{246, 9, 0},
	{245, 10, 0},
	{244, 11, 0},
	{243, 12, 0},
	{242, 13, 0},
	{241, 14, 0},
	{240, 15, 0},
	{239, 16, 0},
	{238, 17, 0},
	{237, 18, 0},
	{236, 19, 0},
	{235, 20, 0},
	{234, 21, 0},
	{233, 22, 0},
	{232, 23, 0},
	{231, 24, 0},
	{230, 25, 0},
	{229, 26, 0},
	{228, 27, 0},
	{227, 28, 0},
	{226, 29, 0},
	{225, 30, 0},
	{224, 31, 0},
	{223, 32, 0},
	{222, 33, 0},
	{221, 34, 0},
	{220, 35, 0},
	{219, 36, 0},
	{218, 37, 0},
	{217, 38, 0},
	{216, 39, 0},
	{215, 40, 0},
	{214, 41, 0},
	{213, 42, 0},
	{212, 43, 0},
	{211, 44, 0},
	{210, 45, 0},
	{209, 46, 0},
	{208, 47, 0},
	{207, 48, 0},
	{206, 49, 0},
	{205, 50, 0},
	{204, 51, 0},
	{203, 52, 0},
	{202, 53, 0},
	{201, 54, 0},
	{200, 55, 0},
	{199, 56, 0},
	{198, 57, 0},
	{197, 58, 0},
	{196, 59, 0},
	{195, 60, 0},
	{194, 61, 0},
	{193, 62, 0},
	{192, 63, 0},
	{191, 64, 0},
	{190, 65, 0},
	{189, 66, 0},
	{188, 67, 0},
	{187, 68, 0},
	{186, 69, 0},
	{185, 70, 0},
	{184, 71, 0},
	{183, 72, 0},
	{182, 73, 0},
	{181, 74, 0},
	{180, 75, 0},
	{179, 76, 0},
	{178, 77, 0},
	{177, 78, 0},
	{176, 79, 0},
	{175, 80, 0},
	{174, 81, 0},
	{173, 82, 0},
	{172, 83, 0},
	{171, 84, 0},
	{170, 85, 0},
	{169, 86, 0},
	{168, 87, 0},
	{167, 88, 0},
	{166, 89, 0},
	{165, 90, 0},
	{164, 91, 0},
	{163, 92, 0},
	{162, 93, 0},
	{161, 94, 0},
	{160, 95, 0},
	{159, 96, 0},
	{158, 97, 0},
	{157, 98, 0},
	{156, 99, 0},
	{155, 100, 0},
	{154, 101, 0},
	{153, 102, 0},
	{152, 103, 0},
	{151, 104, 0},
	{150, 105, 0},
	{149, 106, 0},
	{148, 107, 0},
	{147, 108, 0},
	{146, 109, 0},
	{145, 110, 0},
	{144, 111, 0},
	{143, 112, 0},
	{142, 113, 0},
	{141, 114, 0},
	{140, 115, 0},
	{139, 116, 0},
	{138, 117, 0},
	{137, 118, 0},
	{136, 119, 0},
	{135, 120, 0},
	{134, 121, 0},
	{133, 122, 0},
	{132, 123, 0},
	{131, 124, 0},
	{130, 125, 0},
	{129, 126, 0},
	{128, 127, 0},
	{127, 128, 0},
	{126, 129, 0},
	{125, 130, 0},
	{124, 131, 0},
	{123, 132, 0},
	{122, 133, 0},
	{121, 134, 0},
	{120, 135, 0},
	{119, 136, 0},
	{118, 137, 0},
	{117, 138, 0},
	{116, 139, 0},
	{115, 140, 0},
	{114, 141, 0},
	{113, 142, 0},
	{112, 143, 0},
	{111, 144, 0},
	{110, 145, 0},
	{109, 146, 0},
	{108, 147, 0},
	{107, 148, 0},
	{106, 149, 0},
	{105, 150, 0},
	{104, 151, 0},
	{103, 152, 0},
	{102, 153, 0},
	{101, 154, 0},
	{100, 155, 0},
	{99, 156, 0},
	{98, 157, 0},
	{97, 158, 0},
	{96, 159, 0},
	{95, 160, 0},
	{94, 161, 0},
	{93, 162, 0},
	{92, 163, 0},
	{91, 164, 0},
	{90, 165, 0},
	{89, 166, 0},
	{88, 167, 0},
	{87, 168, 0},
	{86, 169, 0},
	{85, 170, 0},
	{84, 171, 0},
	{83, 172, 0},
	{82, 173, 0},
	{81, 174, 0},
	{80, 175, 0},
	{79, 176, 0},
	{78, 177, 0},
	{77, 178, 0},
	{76, 179, 0},
	{75, 180, 0},
	{74, 181, 0},
	{73, 182, 0},
	{72, 183, 0},
	{71, 184, 0},
	{70, 185, 0},
	{69, 186, 0},
	{68, 187, 0},
	{67, 188, 0},
	{66, 189, 0},
	{65, 190, 0},
	{64, 191, 0},
	{63, 192, 0},
	{62, 193, 0},
	{61, 194, 0},
	{60, 195, 0},
	{59, 196, 0},
	{58, 197, 0},
	{57, 198, 0},
	{56, 199, 0},
	{55, 200, 0},
	{54, 201, 0},
	{53, 202, 0},
	{52, 203, 0},
	{51, 204, 0},
	{50, 205, 0},
	{49, 206, 0},
	{48, 207, 0},
	{47, 208, 0},
	{46, 209, 0},
	{45, 210, 0},
	{44, 211, 0},
	{43, 212, 0},
	{42, 213, 0},
	{41, 214, 0},
	{40, 215, 0},
	{39, 216, 0},
	{38, 217, 0},
	{37, 218, 0},
	{36, 219, 0},
	{35, 220, 0},
	{34, 221, 0},
	{33, 222, 0},
	{32, 223, 0},
	{31, 224, 0},
	{30, 225, 0},
	{29, 226, 0},
	{28, 227, 0},
	{27, 228, 0},
	{26, 229, 0},
	{25, 230, 0},
	{24, 231, 0},
	{23, 232, 0},
	{22, 233, 0},
	{21, 234, 0},
	{20, 235, 0},
	{19, 236, 0},
	{18, 237, 0},
	{17, 238, 0},
	{16, 239, 0},
	{15, 240, 0},
	{14, 241, 0},
	{13, 242, 0},
	{12, 243, 0},
	{11, 244, 0},
	{10, 245, 0},
	{9, 246, 0},
	{8, 247, 0},
	{7, 248, 0},
	{6, 249, 0},
	{5, 250, 0},
	{4, 251, 0},
	{3, 252, 0},
	{2, 253, 0},
	{1, 254, 0},
	{0, 255, 0},
}});
